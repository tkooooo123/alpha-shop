(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-47c69631"],{1258:function(t,e,a){"use strict";a("f8bc")},1713:function(t,e,a){"use strict";a("c74c")},"31a9":function(t,e,a){"use strict";a("ff2b")},"8bf7":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"admin-products-wrapper"},[!0===t.isLoading?e("Spinner"):t._e(),e("div",[e("CreateProductModal",{attrs:{"initial-categories":t.categories},on:{create:t.handleEmit}}),e("div",{staticClass:"productList mt-4"},[e("table",{staticClass:"productList-table"},[!0===t.isProcessing?e("ProcessSpinner"):t._e(),t._m(0),t._l(t.products,(function(a){return e("tbody",{key:a.id,attrs:{id:a.id}},[e("tr",[e("td",{staticClass:"img-wrapper"},[e("img",{attrs:{src:a.image,alt:""}})]),e("td",{staticClass:"productList-item-category"},[t._v(" "+t._s(a.Category.name)+" ")]),e("td",{staticClass:"productList-item-name"},[t._v(t._s(a.name))]),e("td",{staticClass:"productList-item-price"},[t._v("NT$ "+t._s(a.price))]),e("td",{staticClass:"productList-item-btn"},[e("EditProductModal",{attrs:{"initial-product-id":a.id,"initial-categories":t.categories},on:{edit:t.handleEmit}})],1)])])}))],2)]),e("ProductsPagination",{attrs:{"current-page":t.currentPage,"total-page":t.totalPage,"previous-page":t.previousPage,"next-page":t.nextPage,categoryId:t.categoryId}})],1)],1)},i=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th"),e("th",[t._v("分類")]),e("th",[t._v("產品名稱")]),e("th",[t._v("價格")]),e("th",[t._v("編輯/刪除")])])])}],s=(a("d9e2"),a("be6c")),o=a("2fa3"),n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"edit-wrapper"},[e("div",[e("button",{staticClass:"edit-btn",attrs:{type:"button","data-bs-toggle":"modal","data-bs-target":"#editModal"},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.showModal.apply(null,arguments)}}},[e("i",{staticClass:"fa fa-edit fa-lg"})]),e("div",{staticClass:"modal fade",attrs:{id:t.modalId,tabindex:"-1","aria-labelledby":"editModal","aria-hidden":"true"}},[e("div",{staticClass:"modal-dialog"},[!0===t.isProcessing?e("ProcessSpinner"):t._e(),e("div",{staticClass:"modal-content"},[t._m(0),e("div",{staticClass:"modal-body"},[e("form",{staticClass:"formList-wrapper",on:{submit:function(e){return e.preventDefault(),e.stopPropagation(),t.handleSubmit.apply(null,arguments)}}},[e("div",{staticClass:"form-group mt-3"},[e("label",{attrs:{for:"name"}},[t._v("產品名稱")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"name"}],staticClass:"form-control",attrs:{type:"text",id:"name",name:"name",placeholder:"請輸入名稱",required:""},domProps:{value:t.name},on:{input:function(e){e.target.composing||(t.name=e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{staticClass:"form-label",attrs:{for:"categoryId"}},[t._v("分類")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.categoryId,expression:"categoryId"}],staticClass:"form-select",attrs:{"aria-label":"",id:"categoryId",name:"categoryId"},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.categoryId=e.target.multiple?a:a[0]}}},t._l(t.categories,(function(a){return e("option",{key:a.id,domProps:{value:a.id,selected:a.id===t.productCategory}},[t._v(" "+t._s(a.name)+" ")])})),0)]),e("div",{staticClass:"form-group"},[e("span",[e("label",{attrs:{for:"image"}},[t._v("圖片")]),t.product.image?e("img",{staticClass:"d-block img-thumbnail mb-3",attrs:{src:t.product.image,width:"200",height:"200"}}):t._e(),e("input",{staticClass:"form-control",attrs:{type:"file",id:"image",name:"image"},on:{change:t.uploadFile}})])]),e("div",{staticClass:"form-group"},[e("span",[e("label",{attrs:{for:"quantity"}},[t._v("數量")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.quantity,expression:"quantity"}],staticClass:"form-control",attrs:{type:"number",id:"quantity",name:"quantity",placeholder:"請輸入數量",required:""},domProps:{value:t.quantity},on:{input:function(e){e.target.composing||(t.quantity=e.target.value)}}})])]),e("div",{staticClass:"form-group"},[e("span",[e("label",{attrs:{for:"price"}},[t._v("價格")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.price,expression:"price"}],staticClass:"form-control",attrs:{type:"number",id:"price",name:"price",placeholder:"請輸入價格",required:""},domProps:{value:t.price},on:{input:function(e){e.target.composing||(t.price=e.target.value)}}})])]),e("div",{staticClass:"form-group"},[e("span",[e("label",{attrs:{for:"description"}},[t._v("敘述")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.description,expression:"description"}],staticClass:"form-control",attrs:{id:"description",name:"description",required:"",cols:"30",rows:"5"},domProps:{value:t.description},on:{input:function(e){e.target.composing||(t.description=e.target.value)}}})])]),e("div",{staticClass:"btn-wrapper"},[e("button",{staticClass:"prev-btn",attrs:{type:"button"},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.closeModal.apply(null,arguments)}}},[t._v(" 取消 ")]),e("button",{staticClass:"next-btn",attrs:{type:"submit"}},[t._v("儲存")])])])])])],1)])]),e("div",[e("button",{attrs:{type:"button"},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.deleteProduct(t.product)}}},[e("i",{staticClass:"fa fa-trash fa-lg"})])])])},c=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"modal-header"},[e("h5",{staticClass:"modal-title",attrs:{id:"editModalLabel"}},[t._v("編輯產品")]),e("button",{staticClass:"btn-close",attrs:{type:"button","data-bs-dismiss":"modal","aria-label":"Close"}})])}],d=a("7c2b"),l=a.n(d),u=a("c09c"),p={components:{ProcessSpinner:u["a"]},props:{initialProductId:{type:Number,requirede:!0},initialCategories:{type:Array,requirede:!0}},data(){return{product:"",productId:this.initialProductId,categories:this.initialCategories,productCategory:"",model:null,modalId:"",categoryId:"",name:"",quantity:"",price:"",description:"",file:null,isProcessing:!1}},created(){this.fetchProduct()},methods:{async fetchProduct(){try{const t=await s["a"].getProduct({id:this.productId}),{data:e}=t;if("error"===t.status)throw new Error(e.message);this.product=e.product,this.productCategory=this.product.categoryId,this.categoryId=this.product.categoryId,this.name=this.product.name,this.quantity=this.product.quantity,this.price=this.product.price,this.description=this.product.description,this.modalId="editModal"+this.productId}catch(t){o["a"].fire({icon:"error",title:"無法取得產品資料，請稍後再試"})}},showModal(){this.modal=new l.a(document.getElementById(this.modalId)),this.modal.show()},closeModal(){this.modal.hide()},async handleSubmit(t){try{this.isProcessing=!0;const e=t.target,a=new FormData(e),r=await s["a"].putProduct({id:this.productId,formData:a});if("error"===r.status)throw new Error(r.data.message);this.$emit("edit"),this.modal.hide(),this.isProcessing=!1}catch(e){this.isProcessing=!1,o["a"].fire({icon:"error",title:"無法更新產品資料，請稍後再試"})}},async deleteProduct(){try{this.$bus.$emit("processUpdate",{isProcessing:!0});const t=await s["a"].deleteProduct({id:this.productId}),{data:e}=t;if("error"===t.status)throw new Error(e.message);document.getElementById(this.productId).remove(),this.$bus.$emit("processUpdate",{isProcessing:!1})}catch(t){o["a"].fire({icon:"error",title:"無法刪除本項商品，請稍後再試"})}},uploadFile(t){const e=t.target.files;if(0===e.length)this.product.image="";else{const t=window.URL.createObjectURL(e[0]);this.product.image=t}}}},m=p,g=(a("1258"),a("2877")),h=Object(g["a"])(m,n,c,!1,null,null,null),f=h.exports,v=function(){var t=this,e=t._self._c;return e("div",{staticClass:"create-wrapper"},[e("button",{staticClass:"product-create-btn",attrs:{type:"button","data-bs-toggle":"modal","data-bs-target":"#createModal"},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.showModal.apply(null,arguments)}}},[t._v(" 新增產品 ")]),e("div",{staticClass:"modal fade",attrs:{id:"createModal",tabindex:"-1","aria-labelledby":"createModal","aria-hidden":"true"}},[e("div",{staticClass:"modal-dialog"},[!0===t.isProcessing?e("ProcessSpinner"):t._e(),e("div",{staticClass:"modal-content"},[t._m(0),e("div",{staticClass:"modal-body"},[e("form",{staticClass:"formList-wrapper",on:{submit:function(e){return e.preventDefault(),e.stopPropagation(),t.handleSubmit.apply(null,arguments)}}},[e("div",{staticClass:"form-group mt-3"},[e("label",{attrs:{for:"name"}},[t._v("產品名稱")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"name"}],staticClass:"form-control",attrs:{type:"text",id:"name",name:"name",placeholder:"請輸入名稱",required:""},domProps:{value:t.name},on:{input:function(e){e.target.composing||(t.name=e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{staticClass:"form-label",attrs:{for:"categoryId"}},[t._v("分類")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.categoryId,expression:"categoryId"}],staticClass:"form-select",attrs:{"aria-label":"",id:"categoryId",name:"categoryId"},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.categoryId=e.target.multiple?a:a[0]}}},[e("option",{attrs:{value:""}},[t._v("請選擇分類")]),t._l(t.categories,(function(a){return e("option",{key:a.id,domProps:{value:a.id}},[t._v(" "+t._s(a.name)+" ")])}))],2)]),e("div",{staticClass:"form-group"},[e("span",[e("label",{attrs:{for:"image"}},[t._v("圖片")]),t.image?e("img",{staticClass:"d-block img-thumbnail mb-3",attrs:{src:t.image,width:"200",height:"200"}}):t._e(),e("input",{staticClass:"form-control",attrs:{type:"file",id:"image",name:"image"},on:{change:t.uploadFile}})])]),e("div",{staticClass:"form-group"},[e("span",[e("label",{attrs:{for:"quantity"}},[t._v("數量")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.quantity,expression:"quantity"}],staticClass:"form-control",attrs:{type:"number",id:"quantity",name:"quantity",placeholder:"請輸入數量",required:""},domProps:{value:t.quantity},on:{input:function(e){e.target.composing||(t.quantity=e.target.value)}}})])]),e("div",{staticClass:"form-group"},[e("span",[e("label",{attrs:{for:"price"}},[t._v("價格")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.price,expression:"price"}],staticClass:"form-control",attrs:{type:"number",id:"price",name:"price",placeholder:"請輸入價格",required:""},domProps:{value:t.price},on:{input:function(e){e.target.composing||(t.price=e.target.value)}}})])]),e("div",{staticClass:"form-group"},[e("span",[e("label",{attrs:{for:"description"}},[t._v("敘述")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.description,expression:"description"}],staticClass:"form-control",attrs:{id:"description",name:"description",required:"",cols:"30",rows:"5"},domProps:{value:t.description},on:{input:function(e){e.target.composing||(t.description=e.target.value)}}})])]),e("div",{staticClass:"btn-wrapper"},[e("button",{staticClass:"prev-btn",attrs:{type:"button"},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.closeModal.apply(null,arguments)}}},[t._v(" 取消 ")]),e("button",{staticClass:"next-btn",attrs:{type:"submit"}},[t._v("儲存")])])])])])],1)])])},y=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"modal-header"},[e("h5",{staticClass:"modal-title",attrs:{id:"createModalLabel"}},[t._v("新增產品")]),e("button",{staticClass:"btn-close",attrs:{type:"button","data-bs-dismiss":"modal","aria-label":"Close"}})])}],b={components:{ProcessSpinner:u["a"]},props:{initialCategories:{type:Array,requirede:!0}},data(){return{categories:"",modal:null,categoryId:"",name:"",quantity:"",price:"",description:"",image:"",file:null,isProcessing:!1}},created(){this.fetchCategories()},methods:{async fetchCategories(){try{const t=await s["a"].getCategories();if(this.categories=t.data.categories,"error"===t.status)throw new Error(t.data.message)}catch(t){o["a"].fire({icon:"error",title:"無法取得分類資料，請稍後再試"})}},showModal(){this.modal=new l.a(document.getElementById("createModal")),this.modal.show()},closeModal(){this.modal.hide()},async handleSubmit(t){try{this.isProcessing=!0;const e=t.target,a=new FormData(e),r=await s["a"].postProduct({formData:a});if("error"===r.status)throw new Error(r.data.message);this.$emit("create"),this.modal.hide(),this.isProcessing=!1}catch(e){this.isProcessing=!0,o["a"].fire({icon:"error",title:"無法新增產品資料，請稍後再試"})}},uploadFile(t){const e=t.target.files;this.file=e;const a=window.URL.createObjectURL(e[0]);this.image=a}}},P=b,C=(a("31a9"),Object(g["a"])(P,v,y,!1,null,null,null)),w=C.exports,_=a("5374"),I=a("2375"),q={components:{EditProductModal:f,CreateProductModal:w,ProductsPagination:_["a"],Spinner:I["a"],ProcessSpinner:u["a"]},data(){return{products:[],categories:[],updated:!1,categoryId:"",currentPage:1,totalPage:1,previousPage:-1,nextPage:-1,isLoading:!0,isProcessing:!1}},created(){const{page:t="",categoryId:e=""}=this.$route.query;this.fetchProducts({queryPage:t,queryCategoryId:e}),this.$bus.$on("processUpdate",t=>{if(!1===t.isProcessing){const{page:t="",categoryId:e=""}=this.$route.query;this.fetchProducts({queryPage:t,queryCategoryId:e})}this.isProcessing=t.isProcessing})},beforeRouteUpdate(t,e,a){const{page:r="",categoryId:i=""}=t.query;this.isLoading=!0,this.fetchProducts({queryPage:r,queryCategoryId:i}),a()},methods:{async fetchProducts({queryPage:t,queryCategoryId:e}){try{const a=await s["a"].getProducts({page:t,categoryId:e}),{data:r}=a;if(" error"===a.status)throw new Error(r.message);const{currentPage:i,totalPage:o,next:n,prev:c}=r.pagination;this.currentPage=i,this.totalPage=o,this.nextPage=n,this.previousPage=c,this.products=r.products,this.categories=r.categories,this.isLoading=!1}catch(a){this.isLoading=!1,o["a"].fire({icon:"error",title:"無法取得產品資料，請稍後在試"})}},handleEmit(){this.fetchProducts({queryPage:this.page})}}},x=q,L=(a("1713"),Object(g["a"])(x,r,i,!1,null,null,null));e["default"]=L.exports},be6c:function(t,e,a){"use strict";var r=a("2fa3");const i=()=>localStorage.getItem("token");e["a"]={getProducts({page:t,categoryId:e}){const a=new URLSearchParams({page:t,categoryId:e});return r["b"].get("/admin/products?"+a.toString(),{headers:{Authorization:"Bearer "+i()}})},getProduct({id:t}){return r["b"].get("/admin/products/"+t,{headers:{Authorization:"Bearer "+i()}})},putProduct({id:t,formData:e}){return r["b"].put("/admin/products/"+t,e,{headers:{Authorization:"Bearer "+i()}})},postProduct({formData:t}){return r["b"].post("/admin/product",t,{headers:{Authorization:"Bearer "+i()}})},deleteProduct({id:t}){return r["b"].delete(`/admin/products/${t}/delete`,{headers:{Authorization:"Bearer "+i()}})},getCategories(){return r["b"].get("/admin/categories",{headers:{Authorization:"Bearer "+i()}})},createCategory({name:t}){return r["b"].post("/admin/categories",{name:t},{headers:{Authorization:"Bearer "+i()}})},deleteCategory({id:t}){return r["b"].delete("/admin/categories/"+t,{headers:{Authorization:"Bearer "+i()}})},updateCategory({id:t,name:e}){return r["b"].put("/admin/categories/"+t,{name:e},{headers:{Authorization:"Bearer "+i()}})},getOrders({page:t}){const e=new URLSearchParams({page:t});return r["b"].get("/admin/orders?"+e.toString(),{headers:{Authorization:"Bearer "+i()}})},cancelOrder({id:t,data:e}){return r["b"].put(`/admin/orders/${t}/cancel`,{data:e},{headers:{Authorization:"Bearer "+i()}})},updateOrder({id:t,payment:e,shipment:a}){return r["b"].put("/admin/orders/"+t,{payment:e,shipment:a},{headers:{Authorization:"Bearer "+i()}})},getOrder({id:t}){return r["b"].get("/admin/orders/"+t,{headers:{Authorization:"Bearer "+i()}})}}},c74c:function(t,e,a){},f8bc:function(t,e,a){},ff2b:function(t,e,a){}}]);
//# sourceMappingURL=chunk-47c69631.ad716d92.js.map