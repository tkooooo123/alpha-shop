(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f4f0610c"],{"370a":function(t,e,a){},6269:function(t,e,a){},"6d7c":function(t,e,a){"use strict";a("740a")},"740a":function(t,e,a){},be6c:function(t,e,a){"use strict";var r=a("2fa3");const s=()=>localStorage.getItem("token");e["a"]={getProducts({page:t,categoryId:e}){const a=new URLSearchParams({page:t,categoryId:e});return r["b"].get("/admin/products?"+a.toString(),{headers:{Authorization:"Bearer "+s()}})},getProduct({id:t}){return r["b"].get("/admin/products/"+t,{headers:{Authorization:"Bearer "+s()}})},putProduct({id:t,formData:e}){return r["b"].put("/admin/products/"+t,e,{headers:{Authorization:"Bearer "+s()}})},postProduct({formData:t}){return r["b"].post("/admin/product",t,{headers:{Authorization:"Bearer "+s()}})},deleteProduct({id:t}){return r["b"].delete(`/admin/products/${t}/delete`,{headers:{Authorization:"Bearer "+s()}})},getCategories(){return r["b"].get("/admin/categories",{headers:{Authorization:"Bearer "+s()}})},createCategory({name:t}){return r["b"].post("/admin/categories",{name:t},{headers:{Authorization:"Bearer "+s()}})},deleteCategory({id:t}){return r["b"].delete("/admin/categories/"+t,{headers:{Authorization:"Bearer "+s()}})},updateCategory({id:t,name:e}){return r["b"].put("/admin/categories/"+t,{name:e},{headers:{Authorization:"Bearer "+s()}})},getOrders({page:t}){const e=new URLSearchParams({page:t});return r["b"].get("/admin/orders?"+e.toString(),{headers:{Authorization:"Bearer "+s()}})},cancelOrder({id:t,data:e}){return r["b"].put(`/admin/orders/${t}/cancel`,{data:e},{headers:{Authorization:"Bearer "+s()}})},updateOrder({id:t,payment:e,shipment:a}){return r["b"].put("/admin/orders/"+t,{payment:e,shipment:a},{headers:{Authorization:"Bearer "+s()}})},getOrder({id:t}){return r["b"].get("/admin/orders/"+t,{headers:{Authorization:"Bearer "+s()}})}}},db4e:function(t,e,a){"use strict";a("6269")},f626:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"admin-orders-wrapper"},[!0===t.isLoading?e("Spinner"):e("div",[e("div",{staticClass:"orderList mt-4"},[e("table",{staticClass:"orderList-table"},[!0===t.isProcessing?e("ProcessSpinner"):t._e(),e("thead",[e("tr",[e("th",[t._v("訂單編號")]),e("th",[t._v("訂單日期")]),e("th",[t._v("總金額")]),e("th",[t._v("付款狀態")]),e("th",[t._v("配送狀態")]),e("th",[t._v("其他")]),e("th",[t._v("編輯/取消")])])]),t._l(t.orders,(function(a){return e("tbody",{key:a.id},[e("tr",[e("td",{staticClass:"orderList-item-id"},[t._v(" "+t._s(a.id)+" ")]),e("td",{staticClass:"orderList-item-date"},[t._v(" "+t._s(a.createdAt)+" ")]),e("td",{staticClass:"orderList-item-price"},[t._v("NT$ "+t._s(a.amount))]),e("td",{staticClass:"orderList-item-payment"},[e("div",{directives:[{name:"show",rawName:"v-show",value:!a.isEditing,expression:"!order.isEditing"}]},["0"===a.payment_status?e("div",[t._v("未付款")]):"1"===a.payment_status?e("div",[t._v("已付款")]):e("div",[t._v("已取消")])]),e("div",{directives:[{name:"show",rawName:"v-show",value:a.isEditing,expression:"order.isEditing"}]},[e("label",{attrs:{for:"payment"}}),e("select",{directives:[{name:"model",rawName:"v-model",value:a.payment_status,expression:"order.payment_status"}],attrs:{name:"payment",id:"payment"},on:{change:function(e){var r=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(a,"payment_status",e.target.multiple?r:r[0])}}},[e("option",{attrs:{value:"-1"},domProps:{selected:"-1"===a.payment_status}},[t._v(" 已取消 ")]),e("option",{attrs:{value:"0"},domProps:{selected:"0"===a.payment_status}},[t._v(" 未付款 ")]),e("option",{attrs:{value:"1"},domProps:{selected:"1"===a.payment_status}},[t._v(" 已付款 ")])])])]),e("td",{staticClass:"orderList-item-shipment"},[e("div",{directives:[{name:"show",rawName:"v-show",value:!a.isEditing,expression:"!order.isEditing"}]},["0"===a.shipping_status?e("div",[t._v("未配送")]):"1"===a.shipping_status?e("div",[t._v("配送中")]):e("div",[t._v("已取消")])]),e("div",{directives:[{name:"show",rawName:"v-show",value:a.isEditing,expression:"order.isEditing"}]},[e("label",{attrs:{for:"shipment"}}),e("select",{directives:[{name:"model",rawName:"v-model",value:a.shipping_status,expression:"order.shipping_status"}],attrs:{name:"shipment",id:"shipment"},on:{change:function(e){var r=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(a,"shipping_status",e.target.multiple?r:r[0])}}},[e("option",{attrs:{value:"-1"},domProps:{selected:"-1"===a.shipping_status}},[t._v(" 已取消 ")]),e("option",{attrs:{value:"0"},domProps:{selected:"0"===a.shipping_status}},[t._v(" 未配送 ")]),e("option",{attrs:{value:"1"},domProps:{selected:"1"===a.shipping_status}},[t._v(" 配送中 ")])])])]),e("td",[e("AdminOrderModal",{attrs:{"initial-order-id":a.id}})],1),e("td",{staticClass:"orderList-item-btn"},[e("button",{directives:[{name:"show",rawName:"v-show",value:!a.isEditing,expression:"!order.isEditing"}],on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.toggleIsEditing(a.id)}}},[e("i",{staticClass:"fa fa-edit fa-lg"})]),e("button",{directives:[{name:"show",rawName:"v-show",value:a.isEditing,expression:"order.isEditing"}],on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.updateOrder({orderId:a.id,payment:a.payment_status,shipment:a.shipping_status})}}},[e("i",{staticClass:"fa fa-save fa-lg"})]),e("button",{on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.cancelOrder(a)}}},[e("i",{staticClass:"fa fa-cancel fa-lg"})])])])])}))],2)]),e("AdminOrderPaginaiton",{attrs:{"current-page":t.currentPage,"total-page":t.totalPage,"previous-page":t.previousPage,"next-page":t.nextPage}})],1)],1)},s=[],i=(a("d9e2"),a("be6c")),n=a("2fa3"),o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"order-wrapper"},[e("button",{staticClass:"modal-btn",attrs:{type:"button","data-bs-toggle":"modal","data-bs-target":"#exampleModal"},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.showModal.apply(null,arguments)}}},[t._v(" 詳 ")]),e("div",{staticClass:"modal fade",attrs:{id:t.modalId,tabindex:"-1","aria-labelledby":"exampleModal","aria-hidden":"true"}},[e("div",{staticClass:"modal-dialog"},[e("div",{staticClass:"modal-content"},[e("div",{staticClass:"modal-header"},[e("h5",{staticClass:"modal-title",attrs:{id:"exampleModalLabel"}},[t._v("商品明細")]),e("button",{staticClass:"btn-close",attrs:{type:"button","data-bs-dismiss":"modal","aria-label":"Close"},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.closeModal.apply(null,arguments)}}},[e("i",{staticClass:"fa fa-times",attrs:{"aria-hidden":"true"}})])]),e("div",{staticClass:"modal-body"},[e("table",t._l(t.order.orderProducts,(function(a){return e("tbody",{key:a.id},[e("tr",[e("td",{staticClass:"orderProduct-img"},[e("img",{attrs:{src:a.image,alt:""}})]),e("td",{staticClass:"orderProduct-name"},[t._v(" "+t._s(a.name)+" ")]),e("td",{staticClass:"orderProduct-quantity"},[t._v(" "+t._s(a.OrderItem.quantity)+" 件 ")]),e("td",{staticClass:"orderProduct-price"},[t._v(" NT$ "+t._s(a.OrderItem.quantity*a.price)+" ")])])])})),0)]),e("div",{staticClass:"modal-footer"},[e("p",[t._v("收件人姓名: "+t._s(t.order.name))]),e("p",[t._v("收件地址: "+t._s(t.order.address))]),e("p",[t._v("連絡電話: "+t._s(t.order.phone))])])])])])])},d=[],l=a("7c2b"),u=a.n(l),c={props:{initialOrderId:{type:Number,required:!0}},data(){return{order:[],totalPrice:"",modalId:"",modal:null}},created(){this.fetchOrder()},methods:{async fetchOrder(){try{const t=await i["a"].getOrder({id:this.initialOrderId});this.order=t.data.order,this.modalId="order"+this.order.id,this.totalPrice=t.data.totalPrice}catch(t){console.log(t)}},showModal(){this.modal=new u.a(document.getElementById(this.modalId)),this.modal.show()},closeModal(){this.modal.hide()}}},p=c,g=(a("6d7c"),a("2877")),m=Object(g["a"])(p,o,d,!1,null,null,null),h=m.exports,v=function(){var t=this,e=t._self._c;return e("nav",{attrs:{"aria-label":"Page navigation example"}},[e("ul",{staticClass:"pagination"},[e("li",{directives:[{name:"show",rawName:"v-show",value:t.previousPage,expression:"previousPage"}],class:["page-item",{disabled:1===t.currentPage}]},[e("router-link",{staticClass:"page-link",attrs:{"aria-label":"Previous",to:{name:"admin-orders",query:{page:t.previousPage}}}},[e("span",{attrs:{"aria-hidden":"true"}},[t._v("«")])])],1),t._l(t.totalPage,(function(a){return e("li",{key:a,class:["page-item",{active:t.currentPage===a}]},[e("router-link",{staticClass:"page-link",attrs:{to:{name:"admin-orders",query:{page:a}}}},[t._v(" "+t._s(a)+" ")])],1)})),e("li",{directives:[{name:"show",rawName:"v-show",value:t.nextPage,expression:"nextPage"}],class:["page-item",{disabled:t.currentPage===t.totalPage}]},[e("router-link",{staticClass:"page-link",attrs:{to:{name:"admin-orders",query:{page:t.nextPage}},"aria-label":"Next"}},[e("span",{attrs:{"aria-hidden":"true"}},[t._v("»")])])],1)],2)])},_=[],f={props:{currentPage:{type:Number,default:1},totalPage:{type:Number,required:!0},previousPage:{type:Number,required:!0},nextPage:{type:Number,required:!0}}},P=f,y=(a("f898"),Object(g["a"])(P,v,_,!1,null,null,null)),b=y.exports,w=a("2375"),C=a("c09c"),x={components:{AdminOrderModal:h,AdminOrderPaginaiton:b,Spinner:w["a"],ProcessSpinner:C["a"]},data(){return{orders:[],currentPage:1,totalPage:1,previousPage:-1,nextPage:-1,isLoading:!0,isProcessing:!1}},created(){const{page:t=""}=this.$route.query;this.fetchOrders({queryPage:t})},beforeRouteUpdate(t,e,a){const{page:r=""}=t.query;this.isLoading=!0,this.fetchOrders({queryPage:r}),a()},methods:{async fetchOrders({queryPage:t}){try{const e=await i["a"].getOrders({page:t}),{data:a}=e;if("error"===e.status)throw new Error(a.message);this.orders=a.orders.map(t=>({...t,isEditing:!1}));const{currentPage:r,totalPage:s,next:n,prev:o}=a.pagination;this.currentPage=r,this.totalPage=s,this.nextPage=n,this.previousPage=o,this.isLoading=!1}catch(e){this.isLoading=!1,n["a"].fire({icon:"error",title:"無法取得訂單資料，請稍後再試"})}},async cancelOrder(t){try{this.isProcessing=!0;const e=await i["a"].cancelOrder({id:t.id});if("error"===e.status)throw new Error(e.data.message);t.payment_status=-1,t.shipping_status=-1,this.isProcessing=!1}catch(e){this.isProcessing=!1,n["a"].fire({icon:"error",title:"無法取消訂單，請稍後再試"})}},toggleIsEditing(t){this.orders=this.orders.map(e=>e.id===t?{...e,isEditing:!e.isEditing}:e)},async updateOrder(t){try{this.isProcessing=!0;const e=await i["a"].updateOrder({id:t.orderId,payment:t.payment,shipment:t.shipment});if("error"===e.status)throw new Error(e.data.message);this.toggleIsEditing(t.orderId),this.isProcessing=!1}catch(e){this.isProcessing=!1,n["a"].fire({icon:"error",title:"無法編輯訂單資料，請稍後再試"})}}}},O=x,E=(a("db4e"),Object(g["a"])(O,r,s,!1,null,null,null));e["default"]=E.exports},f898:function(t,e,a){"use strict";a("370a")}}]);
//# sourceMappingURL=chunk-f4f0610c.c759c278.js.map